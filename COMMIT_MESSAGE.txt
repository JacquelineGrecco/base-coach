feat(auth): implement comprehensive signup validation and phone field

ğŸ¯ MODULE 1: Authentication - Signup Feature Complete

## âœ¨ New Features

### Signup Form Enhancements
- Add phone number field (required, Brazilian format)
- Real-time phone validation with auto-formatting
- Email format validation with visual feedback
- Block invalid phone numbers (repeated digits)
- Helper text: "Este nÃºmero serÃ¡ usado para validar sua conta"

### Phone Validation Rules
- âœ… Auto-format as user types: (11) 98765-4321
- âœ… Brazilian format: 10-11 digits (DDD + number)
- âœ… Block all same digits: (11) 11111-1111 âŒ
- âœ… Block repeated patterns: (11) 99999-9999 âŒ
- âœ… Real-time error feedback
- âœ… Validation on blur and submit

### Login Security
- Add login attempt limiting (3 attempts max)
- 60-second account lockout after failed attempts
- Real-time countdown timer display
- Shows remaining attempts ("2 tentativas restantes")
- Per-email attempt tracking (localStorage)

### Account Management
- Account deactivation system (replaces deletion)
- WhatsApp support integration for reactivation
- Pre-filled WhatsApp message with user email
- Users marked as inactive (not deleted)
- 365-day grace period before permanent deletion

## ğŸ—„ï¸ Database Changes

### New Migrations
- **022_add_user_deactivation.sql**
  - Add `is_active`, `deactivated_at`, `deactivation_reason` to users
  - Create archive tables (users, teams, categories, players)
  - Update cleanup functions to archive before deleting
  - Change retention from 7 â†’ 365 days
  - Add `deactivate_user_account()` function
  - Add `reactivate_user_account()` function

- **023_add_phone_to_signup_trigger.sql**
  - Update `handle_new_user()` to capture phone from metadata
  - Update `ensure_profile_exists()` to include phone
  - Phone automatically saved during signup

### Archive System
- All deleted data moved to archive tables first
- No permanent data loss
- Full audit trail of deletions
- Restore capability for accidentally deleted data
- Automatic cleanup after 365 days

## ğŸ“ New Scripts

### Cleanup Scripts
- `cleanup_all_data.sql` - Full database wipe (testing)
- `cleanup_all_data_safe.sql` - Delete only your data
- `README_CLEANUP.md` - Complete documentation

### Archive Management
- `view_archived_data.sql` - Query historical deletions
- `restore_from_archive.sql` - Restore deleted data
- Search by email, view statistics, export archives

## ğŸ¨ UI/UX Improvements

### Visual Feedback
- Red borders on invalid fields
- Inline error messages with icons
- Real-time validation as user types
- Clear, Portuguese error messages
- Password strength indicator

### User Experience
- Auto-format phone numbers while typing
- Countdown timer for locked accounts
- WhatsApp button with pre-filled message
- Helpful validation messages
- Smooth transitions and animations

## ğŸ“ Files Modified

### Components
- `components/Auth/Signup.tsx` - Phone field, validation, formatting
- `components/Auth/Login.tsx` - Attempt limiting, countdown, WhatsApp
- `components/Profile.tsx` - Deactivation messaging, updated UI

### Services
- `services/authService.ts` - Added phone parameter to signup
- `services/userService.ts` - Deactivation functions, updated interface

### Contexts
- `contexts/AuthContext.tsx` - Deactivation detection, error handling

### Database
- `supabase/migrations/022_add_user_deactivation.sql` (NEW)
- `supabase/migrations/023_add_phone_to_signup_trigger.sql` (NEW)

### Scripts
- `supabase/scripts/cleanup_all_data.sql` (NEW)
- `supabase/scripts/cleanup_all_data_safe.sql` (NEW)
- `supabase/scripts/view_archived_data.sql` (NEW)
- `supabase/scripts/restore_from_archive.sql` (NEW)

### Documentation
- `docs/MODULE1_AUTH_FIXES_V2.md` (NEW)
- `docs/TESTING_OUTPUT.md` (UPDATED)

## ğŸ§ª Testing

### Validated
- âœ… Email format validation
- âœ… Phone format and auto-formatting
- âœ… Repeated digit detection
- âœ… Login attempt limiting
- âœ… Countdown timer accuracy
- âœ… Form submission validation
- âœ… Database trigger for phone capture

### To Test (User)
- [ ] Complete signup flow with phone
- [ ] Email confirmation
- [ ] Login with new credentials
- [ ] Account deactivation
- [ ] WhatsApp support link

## ğŸ” Security Improvements

- Login brute-force protection (3 attempts)
- Phone validation prevents fake numbers
- Email format validation
- Account lockout mechanism
- Deactivation instead of immediate deletion

## ğŸ“Š Data Safety

- All deletions archived before permanent removal
- 365-day recovery period
- No data loss
- Complete audit trail
- Restore capabilities

## ğŸŒ Localization

- All messages in Portuguese (pt-BR)
- Brazilian phone format
- Clear, user-friendly error messages
- Culturally appropriate validation

## âš™ï¸ Configuration

**Required Setup:**
1. Update WhatsApp number in `Login.tsx` (line ~19)
2. Run migration 022 in Supabase
3. Run migration 023 in Supabase
4. Enable `pg_cron` extension

**WhatsApp Format:**
```typescript
const SUPPORT_WHATSAPP = '5511999999999'; // Update this!
```

## ğŸš€ Next Steps

Module 1 - Authentication testing continues:
- Password reset flow
- Email verification
- Account recovery
- Profile updates
- Other authentication features

---

**Breaking Changes:** None (additive only)
**Migration Required:** Yes (022, 023)
**Version Impact:** Minor (v1.7.1 or v1.8.0)

Co-authored-by: AI Assistant

